from string import Template

# 初始三选一 + 其他
INIT_PROMPT_TMPL = Template(
    "我正在构思一个小说，以下是我关于该小说的全部已有信息，你对其中已知信息进行整理归纳。"
    "并给出第一章的故事情节选择（给出3个选择，以及一个“其他选择“）。"
    "如果主角/背景/情节等小说核心要素严重缺乏以至于难以给出合理选择，你需要对这些要素挨个给出选择题"
    "（形式如上，3个选择加一个其他选择）。已知信息如下：\n\n"
    "$seed\n\n"
    "【输出格式要求】请返回严格 JSON，不要输出多余文字：\n"
    "{\n"
    "  \"type\": \"start\" 或 \"need_core_elements\",\n"
    "  \"summary\": \"<对已知信息的整理归纳>\",\n"
    "  \"choices\": [\"<选择1>\", \"<选择2>\", \"<选择3>\"],\n"
    "  \"other\": \"其他选择\"\n"
    "}\n"
)

# 阶段性总结（用于推进下一层）
STAGE_SUMMARY_TMPL = Template(
    "请将以下内容和剧情进行整理，以方便后续剧情的推理，不要遗漏关键和细节：\n\n"
    "$history\n\n"
    "【输出格式要求】只返回严格 JSON：\n{\n  \"stage_summary\": \"<阶段性总结>\",\n  \"key_points\": [\"<要点1>\", \"<要点2>\", \"<要点3>\"]\n}\n"
)

# 下一步三选一 + 其他
NEXT_CHOICES_TMPL = Template(
    "这是前面的剧情内容总结：\n$prior_summary\n\n"
    "阶段性总结：\n$stage_summary\n\n"
    "用户选择：\n$selected\n\n"
    "请推理下面的剧情，给出三种剧情走向选择。\n\n"
    "【输出格式要求】只返回严格 JSON：\n{\n  \"choices\": [\"<走向1>\", \"<走向2>\", \"<走向3>\"],\n"
    "  \"other\": \"其他选择\"\n}\n"
)

# 世界线总结（根 -> 当前 的全路径汇总）
WORLDLINE_SUMMARY_TMPL = Template(
    "下面是某条世界线从根到当前节点的全部文本信息，已按顺序（从根到当前）列出：\n\n"
    "$ordered\n\n"
    "请输出“当前世界线下的剧情总结”。\n"
    "要求：\n"
    "1) 先整理【已知信息】（避免重复矛盾）；\n"
    "2) 再给出【剧情推进】：用“1. 2. 3. ...”分点，每个分点对应一个决策点，顺序与路径一致，总计 $count 个分点；\n"
    "3) 严格 JSON。\n\n"
    "【输出格式（严格 JSON）】\n"
    "{\n"
    "  \"known\": \"<整理后的已知信息（段落文本）>\",\n"
    "  \"progress\": [\"<第1个决策点的推进>\", \"<第2个决策点的推进>\", \"...\"]\n"
    "}\n"
)

# ★ 新增：已知信息清单抽取模板（尽可能填满，没有就填“未知”）
EXTRACT_KNOWN_TMPL = Template(
    "请从下列资料中提取并填写一个小说创作卡的“已知信息清单”。"
    "优先依据“已知信息（整理文本）”，同时可参考初始 Seed 与分点推进。没有信息也请填写“未知”。\n\n"
    "【已知信息（整理文本）】\n$known\n\n"
    "【初始 Seed】\n$seed\n\n"
    "【剧情推进分点】\n$progress\n\n"
    "请返回严格 JSON（key 必须与下列中文标签逐字匹配）：\n"
    "{\n"
    "  \"第一部分：故事内核与基调\": {\n"
    "    \"核心概念 (High Concept)\": \"\",\n"
    "    \"题材类型 (Genre)\": \"\",\n"
    "    \"故事基调 (Tone & Mood)\": \"\",\n"
    "    \"核心主题 (Central Theme)\": \"\",\n"
    "    \"目标读者 (Target Audience)\": \"\"\n"
    "  },\n"
    "  \"第二部分：世界观设定\": {\n"
    "    \"宏观背景 (Macro Setting)\": \"\",\n"
    "    \"社会结构 (Social Structure)\": \"\"\n"
    "  },\n"
    "  \"第三部分：核心系统与规则\": {\n"
    "    \"力量体系 (Power System)\": \"\",\n"
    "    \"金手指/特殊优势 (Protagonist's Edge)\": \"\",\n"
    "    \"核心物品与道具 (Key Items & Artifacts)\": \"\"\n"
    "  },\n"
    "  \"第四部分：角色设定\": {\n"
    "    \"主角设定 (Protagonist)\": \"\",\n"
    "    \"反派设定 (Antagonist)\": \"\",\n"
    "    \"配角设定 (Supporting Cast)\": \"\",\n"
    "    \"人际关系网 (Relationship Web)\": \"\"\n"
    "  },\n"
    "  \"第五部分：剧情结构与叙事\": {\n"
    "    \"故事主线 (Main Plot)\": \"\",\n"
    "    \"核心矛盾 (Core Conflict)\": \"\",\n"
    "    \"叙事视角 (Narrative Perspective)\": \"\",\n"
    "    \"关键情节节点 (Key Plot Points)\": \"\",\n"
    "    \"支线情节 (Subplots)\": \"\"\n"
    "  }\n"
    "}\n"
)
